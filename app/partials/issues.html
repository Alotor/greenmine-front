<div class="header-container container-fluid" ng-include="'partials/header.html'"></div>
<div class="middle-container container-fluid issues">
    <div class="row-fluid first-row">
        <div class="span12">
            <div class="filters-container">
                <div class="filters-visual-box" ng-show="filtersOpened">
                    <div class="tags-list-sbox">
                        <div class="tag" ng-repeat="tag in tags" ng-click="selectTag(tag)"
                                ng-class="{selected: tag.selected}" gm-colorize-tag>
                            <div class="icon">
                                <i class="icon-remove icon-white" ng-hide="!tag.selected"> </i>
                            </div>
                            <div class="name">{{ tag.name }}</div>
                            <div class="count">{{ tag.count }}</div>
                        </div>
                    </div>
                </div>

                <div class="filters-bar-sbox">
                    <div class="title-sbox">
                        <i class="icon-chevron-down" ng-hide="filtersOpened"></i>
                        <i class="icon-chevron-up" ng-hide="!filtersOpened"></i>

                        <a href="" ng-click="filtersOpened=!filtersOpened">Filters</a>
                    </div>
                    <div class="buttons-sbox">
                        <a class="btn btn-small" ng-click="issueFormOpened=!issueFormOpened">New issue</a>
                    </div>
                </div>

                <div class="issue-form-sbox" ng-show="issueFormOpened">
                    <form action="" ui-parsley="issueSubmit()">
                        <fieldset>
                            <div>Task text:</div>
                            <textarea ng-model="issueForm.text" data-required="true"></textarea>
                        </fieldset>
                        <fieldset>
                            <input type="submit" class="btn btn-success" value="Save" />
                            <a href="" class="btn" ng-click="issueFormOpened=false">Close</a>
                        </fieldset>
                    </form>
                </div>

                <div class="filters-selected-box"></div>
            </div>

            <div class="issues-container">
                <div class="issues-table-list">
                    <div class="flex-header" gm-issues-sort>
                        <div data-field="severity" class="issue-sortable-field issue-severity">
                            <i class="icon-chevron-down"></i> Severity</div>

                        <div data-field="subject" class="issue-sortable-field issue-title">
                            <i class="icon-chevron-down"></i> Subject</div>

                        <div data-field="state" class="issue-sortable-field issue-state">
                            <i class="icon-chevron-down"></i> Status</div>

                        <div data-field="priority" class="issue-sortable-field issue-priority">
                            <i class="icon-chevron-down"></i> Priority</div>

                        <div data-field="assigned_to" class="issue-sortable-field issue-assignedto">
                            <i class="icon-chevron-down"></i> Assigned to</div>

                        <div class="issue-options">Options</div>
                    </div>
                    <div class="flex-separator"></div>
                    <div class="flex-body">
                        <div class="issue-item" ng-repeat="issue in pagedItems[currentPage]">
                            <div class="issue-severity">
                                <a href="" gm-issue-severity-popover="saveIssue(issue)">{{ resolveSeverity(issue.severity) }}</a>
                            </div>
                            <div class="issue-title">
                                <span class="title">{{ issue.subject }}</span>
                                <span class="tags">
                                    <span ng-repeat="tag in issue.tags" class="label" gm-colorize-tag>{{ tag.name }}</span>
                                </span>
                            </div>
                            <div class="issue-state">
                                <a href="" gm-issue-status-popover="saveIssue(issue)">{{ resolveStatus(issue.status) }}</a>
                            </div>
                            <div class="issue-priority">
                                <a href="" gm-issue-priority-popover="saveIssue(issue)">{{ resolvePriority(issue.priority) }}</a>
                            </div>
                            <div class="issue-assignedto">
                                <div gm-developer-popover="saveIssue(issue)">
                                    <div class="button-item" ng-show="issue.assigned_to">
                                        <i class="icon-user"></i> <a href="" class=""><span>{{ issue.assigned_to }}</span></a>
                                    </div>
                                    <div class="button-item" ng-show="!issue.assigned_to">
                                        <i class="icon-question-sign"></i> <a href="" class=""><span>Unassigned</span></a>
                                    </div>
                                </div>
                            </div>
                            <div class="issue-options">
                                <a class="btn btn-mini btn-success" gm-preview-popover
                                    data-template-selector="#issue-preview-popover" data-context="issue">
                                    <i class="icon-eye-open icon-white"></i>
                                </a>

                                <a class="btn btn-mini btn-success" href="{{ urls.issuesUrl(projectId, issue.id) }}"><i class="icon-edit icon-white"></i></a>
                                <a class="btn btn-mini btn-danger" gm-remove-popover="removeTask(task)"
                                    data-template-selector="#issue-remove-popover" data-context="issue">
                                        <i class="icon-remove icon-white"></i>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="pagination pull-right pagination-small">
                        <ul>
                            <li ng-class="{disabled: currentPage == 0}">
                                <a href ng-click="prevPage()">« Prev</a>
                            </li>
                            <li ng-repeat="n in range(pagedItems.length)"
                                ng-class="{active: n == currentPage}"
                            ng-click="setPage()">
                                <a href ng-bind="n + 1">1</a>
                            </li>
                            <li ng-class="{disabled: currentPage == pagedItems.length - 1}">
                                <a href ng-click="nextPage()">Next »</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="dialogs hidden">
        <div class="points-popover" id="points-popover">
            <div class="item" ng-repeat="p in points">
                <a class="btn btn-mini" data-id="{{ p }}">{{ p }}</a>
            </div>
        </div>
    </div>

    <script type="text/template" id="issue-preview-popover">
        <div class="us-preview-popover">
            <section>
                <strong>Subject:</strong><br /><%= issue.subject %>
            </section>
            <section>
                <strong>Description:</strong>
                <p><%= issue.description %></p>
            </section>
        </div>
    </script>

    <script type="text/template" id="issue-remove-popover">
        <div class="us-remove-popover">
            <section>
                <p>Are you sure you want to delete this task:
                    <strong><%= issue.subject %></strong></p>
            </section>
            <section>
                <input type="button" class="btn btn-success btn-delete" value="Delete" />
                <input type="button" class="btn btn-cancel" value="Cancel" />
            </section>
        </div>
    </script>
    <script type="text/template" id="developers-popover">
        <div class="developers-popover">
            Select a developer:
            <ul>
                <li><a href="" data-dev-id="">Unassigned</a>
                <% _.each(developers, function(dev) { %>
                <li>
                    <a href="" data-dev-id="<%= dev.id %>"><%= dev.name %></a>
                </li>
                <% }); %>
            </ul>
        </div>
    </script>
    <script type="text/template" id="severity-popover">
        <div class="severity-popover">
            Select severity:
            <ul>
                <% _.each(list, function(obj) { %>
                <li><a href="" data-id="<%= obj.id %>"><%= obj.name %></a></li>
                <% }); %>
            </ul>
        </div>
    </script>
    <script type="text/template" id="priority-popover">
        <div class="priority-popover">
            Select priority:
            <ul>
                <% _.each(list, function(obj) { %>
                <li><a href="" data-id="<%= obj.id %>"><%= obj.name %></a></li>
                <% }); %>
            </ul>
        </div>
    </script>
    <script type="text/template" id="status-popover">
        <div class="status-popover">
            Select status:
            <ul>
                <% _.each(list, function(obj) { %>
                <li><a href="" data-id="<%= obj.id %>"><%= obj.name %></a></li>
                <% }); %>
            </ul>
        </div>
    </script>
</div>
