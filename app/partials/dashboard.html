<header class="header-container" ng-include="'/partials/header.html'"></header>
<div class="middle-container container-fluid dashboard">
    <div class="row-fluid first-row stats-row">
        <div class="span12">
            <div class="stats-container">
                <div class="row-fluid">
                    <div class="span8">
                        <div class="graphics-box" <!-- gm-canvas-test --> >
                        </div>
                    </div>
                    <div class="span4">
                        <div class="information-box">
                            <div class="info-header">
                                <div class="progress-box">
                                    <div class="progress">
                                        <div class="bar" style="width: {{ stats.percentageCompletedPoints }}%"></div>
                                    </div>

                                    <div class="progress-indicator">{{ stats.percentageCompletedPoints }}%</div>
                                    <div class="help">completed<br />points</div>
                                </div>
                            </div>
                            <div class="info-rows">
                                <div class="row-item">
                                    <div class="row-label">Points</div>
                                    <div class="row-indicator">{{ stats.totalPoints }}</div>
                                    <div class="row-help">total <br />points</div>
                                    <div class="row-indicator">{{ stats.completedPoints }}</div>
                                    <div class="row-help">completed <br />points</div>
                                </div>

                                <div class="row-item">
                                    <div class="row-label">Tasks</div>
                                    <div class="row-indicator">{{ stats.totalTasks }}</div>
                                    <div class="row-help">total <br />tasks</div>
                                    <div class="row-indicator">{{ stats.completedTasks }}</div>
                                    <div class="row-help">completed <br />tasks</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span12">
            <div class="tasks-container">
                <div class="header">
                    <table>
                        <tbody>
                            <tr>
                                <td class="row-us-description" style="width: {{ 100/(statuses.length+1) }}%"></td>
                                <td class="" ng-repeat="status in statuses|orderBy:'order'" style="width: {{ 100/(statuses.length+1) }}%; border-right-color: {{ status.color }}">
                                    <div class="badge" style="background-color: {{ status.color }};">{{ status.name }}</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="body" gm-newtask-modal=".row-us-description .new-task">
                    <table ng-repeat="us in userstories" ng-controller="DashboardUserStoryController">
                        <tbody>
                            <tr>
                                <td class="row-us-description" style="width: {{ 100/(statuses.length+1) }}%">
                                    <div class="info">
                                        <div class="title">{{ us.subject }}</div>
                                        <div class="description">
                                            <p>{{ us.description }}</p>
                                        </div>
                                    </div>
                                    <div class="options">
                                        <ul>
                                            <li>
                                                <a href="" class="button" gm-modal="#new-task-modal">New task</a>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                                <td class="col-task-status col-task-{{ status.name|slugify }}"
                                        ng-repeat="status in statuses|orderBy:'order'"
                                        style="width: {{ 100/(statuses.length+1) }}%">

                                    <div class="tasks" ui-sortable=".tasks-container .body .tasks" ng-model="usTasks[us.id][status.id]">
                                        <div class="task-box" ng-repeat="task in usTasks[us.id][status.id]"
                                            ng-include="'/partials/dashboard-task.html'"></div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script type="text/template" id="new-task-modal">
        <div class="new-task-modal modal hide">
            <form class="inline-form task-form" ui-parsley="submitTask()">
                <div class="modal-header">
                    <h3>Modal title</h3>
                </div>
                <div class="modal-body">
                    <div class="fieldset-row">
                        <fieldset>
                            <label>Subject</label>
                            <input class="subject" type="text" data-required="true"
                                data-error-message="Required"
                                ng-model="form.subject"></input>
                        </fieldset>
                        <fieldset>
                            <label>Status</label>
                            <select class="status" name="status" ng-model="form.status" data-required="true"
                                data-type="number" data-error-message="Required"
                                ng-options="c.id as c.name for c in statuses|orderBy:'order'"></select>
                            </select>
                        </fieldset>
                    </div>
                    <div class="fieldset-row">
                        <fieldset>
                            <label>Tags</label>
                            <input type="text" class="tags" name="status" value="" ng-model="form.tags" ui-select2></input>
                        </fieldset>
                    </div>
                    <div class="fieldset-row">
                        <fieldset>
                            <label>Description</label>
                            <textarea class="description" ng-model="form.description"></textarea>
                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <input type="submit" class="button button-success" value="Save" />
                    <a href="" class="button button-cancel">Close</a>
                </div>
            </form>
        </div>
    </script>
    <script type="text/template" id="developers-popover">
        <div class="developers-popover">
            Select a user:
            <ul>
                <li><a class="btn-accept" href="">Unassigned</a>
                <li ng-repeat="obj in constants.usersList">
                    <a class="btn-accept" href="">{{ obj.username }}</a>
                </li>
            </ul>
        </div>
    </script>
</div>
